<!DOCTYPE html>
{% load static %}
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel</title>
    <!-- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ Bootstrap -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <link rel="stylesheet" href="{% static 'css/admin.css' %}">
    <link rel="apple-touch-icon" sizes="180x180" href="{% static "favicon/apple-touch-icon.png" %}">
    <link rel="icon" type="image/png" sizes="32x32" href="{% static "favicon/favicon-32x32.png" %}">
    <link rel="icon" type="image/png" sizes="16x16" href="{% static "favicon/favicon-16x16.png" %}">
    <link rel="manifest" href="{% static "favicon/site.webmanifest" %}">
    <link rel="mask-icon" href="{% static "favicon/safari-pinned-tab.svg" %}" color="#5bbad5">
    <meta name="apple-mobile-web-app-title" content="AnonLoader">
    <meta name="application-name" content="AnonLoader">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="theme-color" content="#ffffff">
    <!-- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ Font Awesome –¥–ª—è –∏–∫–æ–Ω–æ–∫ -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body>
    <div class="container-fluid">
        <!-- Navbar –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤ -->
        <nav class="navbar navbar-expand-lg navbar-light bg-light d-lg-none">
            <div class="container-fluid">
                <a class="navbar-brand" href="#">–ê–¥–º–∏–Ω –ü–∞–Ω–µ–ª—å</a>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#mobileNavbar" aria-controls="mobileNavbar" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="mobileNavbar">
                    <ul class="navbar-nav flex-column">
                        <li class="nav-item">
                            <a class="nav-link {% if section == 'broadcast' %}active{% endif %}" href="{% url 'broadcast' %}"><i class="fas fa-paper-plane"></i> –°–¥–µ–ª–∞—Ç—å —Ä–∞—Å—Å—ã–ª–∫—É</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link {% if section == 'manage_users' %}active{% endif %}" href="{% url 'manage_users' %}"><i class="fas fa-users"></i> –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link {% if section == 'statistics' %}active{% endif %}" href="{% url 'statistics' %}"><i class="fas fa-chart-line"></i> –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</a>
                        </li>
                    </ul>
                </div>
            </div>
        </nav>

        <div class="row">
            <!-- –õ–µ–≤–∞—è –ø–∞–Ω–µ–ª—å —Å –∫–Ω–æ–ø–∫–∞–º–∏ –¥–ª—è –±–æ–ª—å—à–∏—Ö —ç–∫—Ä–∞–Ω–æ–≤ -->
            <div class="col-md-3 col-lg-2 sidebar py-3 d-none d-md-block">
                <ul class="nav flex-column">
                    <li class="nav-item">
                        <a class="nav-link {% if section == 'broadcast' %}active{% endif %}" href="{% url 'broadcast' %}"><i class="fas fa-paper-plane"></i> –°–¥–µ–ª–∞—Ç—å —Ä–∞—Å—Å—ã–ª–∫—É</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link {% if section == 'manage_users' %}active{% endif %}" href="{% url 'manage_users' %}"><i class="fas fa-users"></i> –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link {% if section == 'statistics' %}active{% endif %}" href="{% url 'statistics' %}"><i class="fas fa-chart-line"></i> –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</a>
                    </li>
                </ul>
            </div>

            <!-- –ü—Ä–∞–≤–∞—è –ø–∞–Ω–µ–ª—å —Å –æ–∫–Ω–∞–º–∏ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è -->
            <div class="col-md-9 col-lg-10 py-3">
                {% if section == 'broadcast' %}
                <!-- –†–∞–∑–¥–µ–ª –¥–ª—è —Ä–∞—Å—Å—ã–ª–∫–∏ -->
                <div class="card mb-3">
                    <div class="card-header">
                        <h2>üì¢ –°–¥–µ–ª–∞—Ç—å —Ä–∞—Å—Å—ã–ª–∫—É</h2>
                    </div>
                    <div class="card-body">
                        <form method="post" enctype="multipart/form-data">
                            {% csrf_token %}
                            <div class="mb-3">
                                <label for="message" class="form-label">–°–æ–æ–±—â–µ–Ω–∏–µ</label>
                                <textarea class="form-control" id="message" name="message" rows="3"></textarea>
                            </div>
                            <div class="mb-3">
                                <label for="image" class="form-label">–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)</label>
                                <input class="form-control" type="file" id="image" name="image">
                            </div>
                            {% if status %}
                                <div class="alert alert-success">{{ status }}</div>
                            {% endif %}
                            <button type="submit" class="btn btn-primary">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
                        </form>
                    </div>
                </div>
                {% elif section == 'manage_users' %}
                <!-- –†–∞–∑–¥–µ–ª –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ -->
                <div class="card mb-3">
                    <div class="card-header">
                        <h2>üë§ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏</h2>
                    </div>
                    <div class="card-body">
                        <input class="form-control mb-3" id="searchUserInput" type="text" placeholder="–ü–æ–∏—Å–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è">
                        <ul class="list-group" id="userList">  
                            {% for user in users %}
                            <li class="list-group-item d-flex justify-content-between align-items-center">
                                <div>
                                    <strong>{{ user.username }}</strong> (ID: {{ user.user_id }})
                                </div>
                                <div>
                                    <!-- –†–æ–ª—å -->
                                    <form method="post" style="display:inline;">
                                        {% csrf_token %}
                                        <input type="hidden" name="user_id" value="{{ user.user_id }}">
                                        {% if user.is_admin %}
                                            <button class="btn btn-sm btn-outline-primary" name="action" value="remove_admin">–°–Ω—è—Ç—å –∞–¥–º–∏–Ω–∫—É</button>
                                        {% else %}
                                            <button class="btn btn-sm btn-outline-primary" name="action" value="make_admin">–°–¥–µ–ª–∞—Ç—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º</button>
                                        {% endif %}
                                    </form>
                
                                    <!-- –ü–æ–¥–ø–∏—Å–∫–∞ -->
                                    <form method="post" style="display:inline;">
                                        {% csrf_token %}
                                        <input type="hidden" name="user_id" value="{{ user.user_id }}">
                                        {% if user.subscription_type == 'FREE' %}
                                            <button class="btn btn-sm btn-outline-primary" name="action" value="add_subscription">–î–æ–±–∞–≤–∏—Ç—å –ø–æ–¥–ø–∏—Å–∫—É</button>
                                        {% else %}
                                            <button class="btn btn-sm btn-outline-primary" name="action" value="remove">–£–¥–∞–ª–∏—Ç—å –ø–æ–¥–ø–∏—Å–∫—É</button>
                                        {% endif %}
                                    </form>
                
                                    <!-- –°–æ—Å—Ç–æ—è–Ω–∏–µ –∞–∫–∫–∞—É–Ω—Ç–∞ -->
                                    <form method="post" style="display:inline;">
                                        {% csrf_token %}
                                        <input type="hidden" name="user_id" value="{{ user.user_id }}">
                                        {% if user.is_blocked %}
                                            <button class="btn btn-sm btn-outline-primary" name="action" value="unblock">–†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å</button>
                                        {% else %}
                                            <button class="btn btn-sm btn-outline-primary" name="action" value="block">–ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å</button>
                                        {% endif %}
                                    </form>
                                </div>
                            </li>
                            {% endfor %}
                        </ul>
                    </div>
                </div>
                {% elif section == 'statistics' %}
                <!-- –†–∞–∑–¥–µ–ª –¥–ª—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ -->
                <div class="card mb-3">
                    <div class="card-header">
                        <h2>üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h2>
                    </div>
                    <div class="card-body">
                        <canvas id="subscribersChart"></canvas>
                    </div>
                </div>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- –°–∫—Ä–∏–ø—Ç –¥–ª—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –≥—Ä–∞—Ñ–∏–∫–∞ –ø–æ–¥–ø–∏—Å—á–∏–∫–æ–≤ -->
    {% if section == 'statistics' %}
    <script>
        const ctx = document.getElementById('subscribersChart').getContext('2d');
        const subscribersChart = new Chart(ctx, {
            type: 'bar',  // –û—Å–Ω–æ–≤–Ω–æ–π —Ç–∏–ø –≥—Ä–∞—Ñ–∏–∫–∞
            data: {
                labels: {{ statistics.labels | safe }},  // –ú–µ—Ç–∫–∏ –¥–ª—è –æ—Å–∏ X
                datasets: [
                    {
                        label: '–ù–æ–≤—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏',
                        data: {{ statistics.new_subscribers_data | safe }},  // –î–∞–Ω–Ω—ã–µ –Ω–æ–≤—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
                        backgroundColor: 'rgba(75, 192, 192, 0.5)',  // –¶–≤–µ—Ç —Å—Ç–æ–ª–±—Ü–æ–≤
                        borderColor: 'rgba(75, 192, 192, 1)',
                        borderWidth: 1,
                        type: 'bar',  // –¢–∏–ø –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –Ω–æ–≤—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
                    },
                    {
                        label: '–ü—Ä–µ–º–∏—É–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏',
                        data: {{ statistics.premium_users_data | safe }},  // –î–∞–Ω–Ω—ã–µ –ø—Ä–µ–º–∏—É–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
                        backgroundColor: 'rgba(255, 205, 86, 0.5)',  // –¶–≤–µ—Ç —Å—Ç–æ–ª–±—Ü–æ–≤
                        borderColor: 'rgba(255, 205, 86, 1)',
                        borderWidth: 1,
                        type: 'bar',  // –¢–∏–ø –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –ø—Ä–µ–º–∏—É–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
                    },
                    {
                        label: '–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å—Å—ã–ª–∫–∏',
                        data: {{ statistics.link_data | safe }},  // –î–∞–Ω–Ω—ã–µ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Å—Å—ã–ª–æ–∫
                        borderColor: 'rgba(255, 99, 132, 1)',  // –¶–≤–µ—Ç –ª–∏–Ω–∏–∏
                        borderWidth: 2,
                        fill: false,
                        type: 'line',  // –¢–∏–ø –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Å—Å—ã–ª–æ–∫
                    }
                ]
            },
            options: {
                responsive: true,
                plugins: {
                    legend: {
                        position: 'top',
                    },
                    title: {
                        display: true,
                        text: '–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –Ω–æ–≤—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, –ø—Ä–µ–º–∏—É–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Å—Å—ã–ª–æ–∫ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 30 –¥–Ω–µ–π'
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true
                    }
                }
            }
        });
    </script>
    {% endif %}

    <script src="{% static 'js/admin.js' %}"></script>
</body>
</html>
